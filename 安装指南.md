# CD2备份空文件夹清理插件 - 安装指南

## 📋 插件信息
- **名称**: CD2备份空文件夹清理
- **版本**: 1.0.4  
- **类型**: MoviePilot V2 插件
- **功能**: 专为CD2备份清理而设计，自动删除指定目录下的空文件

## 🚀 安装步骤

### 方法1: 手动安装（推荐）

1. **下载插件文件**
   ```bash
   # 如果你有git仓库访问权限
   git clone <仓库地址>
   
   # 或者下载ZIP文件并解压
   ```

2. **复制插件到MoviePilot目录**
   ```bash
   # 复制插件主文件
   cp -r plugins.v2/emptyfilecleaner /path/to/moviepilot/plugins.v2/
   
   # 复制或合并package.v2.json
   # 注意：如果MoviePilot根目录已有package.v2.json，需要合并内容
   cp package.v2.json /path/to/moviepilot/
   ```

3. **重启MoviePilot**
   ```bash
   # 重启MoviePilot服务
   systemctl restart moviepilot  # 或你的重启方式
   ```

### 方法2: 通过MoviePilot插件市场安装

1. 在MoviePilot管理界面进入"插件"页面
2. 点击"插件市场"或"安装插件"
3. 如果支持从URL安装，使用本仓库的URL
4. 搜索"CD2备份空文件夹清理"并安装

## 🔧 配置说明

### 基本配置

1. **启用插件**
   - 在插件管理页面找到"CD2备份空文件夹清理"
   - 点击启用开关

2. **设置目标目录**
   ```
   /path/to/your/cd2/backup/dir1
   /path/to/your/cd2/backup/dir2
   ```

3. **设置排除目录（可选）**
   ```
   /path/to/exclude/dir1
   /path/to/exclude/dir2
   ```

4. **其他配置**
   - **最小文件大小**: 0 字节（小于等于此大小视为空文件）
   - **删除空目录**: 建议开启
   - **执行周期**: 默认每天凌晨2点 (0 2 * * *)
   - **测试模式**: 首次使用请务必开启！

### 高级配置

- **仅运行一次**: 适合临时清理
- **消息通知**: 清理完成后发送通知
- **日志级别**: 可在MoviePilot日志中查看详细执行情况

## ⚠️ 安全建议

1. **首次使用务必开启测试模式**
   - 测试模式只会显示要删除的文件，不会实际删除
   - 确认清理列表无误后再关闭测试模式

2. **谨慎设置目标目录**
   - 确保目标目录路径正确
   - 避免设置系统重要目录

3. **备份重要数据**
   - 建议在首次运行前备份重要文件
   - 可以使用"仅运行一次"模式进行小批量测试

## 🔍 故障排除

### 插件无法安装

1. **检查MoviePilot版本**
   - 确保使用MoviePilot V2版本
   - V1版本不支持此插件

2. **检查文件权限**
   ```bash
   # 确保MoviePilot有读写权限
   chown -R moviepilot:moviepilot /path/to/moviepilot/plugins.v2/emptyfilecleaner
   chmod -R 755 /path/to/moviepilot/plugins.v2/emptyfilecleaner
   ```

3. **检查package.v2.json格式**
   - 确保JSON格式正确
   - 如果有现有的package.v2.json，请正确合并内容

4. **查看MoviePilot日志**
   ```bash
   # 查看详细错误信息
   tail -f /path/to/moviepilot/logs/moviepilot.log
   ```

### 插件安装成功但不显示

1. **强制刷新浏览器缓存**
   - 按Ctrl+F5或Cmd+Shift+R

2. **检查插件配置**
   - 确保插件配置项正确加载

3. **重启MoviePilot服务**

### 清理功能异常

1. **检查目录权限**
   - 确保MoviePilot有目标目录的读写权限

2. **查看插件日志**
   - 在MoviePilot日志中搜索"CD2备份空文件夹清理"相关日志

3. **使用测试模式**
   - 开启测试模式查看扫描结果

## 📞 支持

如果遇到问题，请提供以下信息：
- MoviePilot版本
- 操作系统信息  
- 错误日志
- 插件配置截图

## 📝 更新日志

- **v1.0.4**: 修改插件名称为CD2备份空文件夹清理，优化安装兼容性
- **v1.0.3**: 根据V2插件标准修复bug，增加版本检测和兼容性处理
- **v1.0.2**: 改进空目录检测逻辑，增加详细日志输出，新增扫描空目录功能
- **v1.0.1**: 优化代码结构，增加线程安全锁
- **v1.0.0**: 初始版本，支持空文件清理和目录排除功能
