# MoviePilot 空文件清理器插件

这是一个为 MoviePilot 开发的空文件清理器插件，主要用于自动删除指定目录下的空文件（包括子目录），支持排除指定目录。

## 主要功能

✅ **删除指定目录下的空文件（包括子目录）**  
✅ **能够排除指定目录本身（自己不被删除，但是子文件需要检查是否为空文件）**  
✅ 支持设置最小文件大小阈值（小于等于该大小的文件视为空文件）  
✅ 支持删除空目录  
✅ 支持定时执行和手动执行  
✅ 支持测试模式（预览将要删除的文件而不实际删除）  
✅ 支持消息通知  
✅ 支持远程命令控制  
✅ 线程安全设计  

## 目录结构

```
├── plugins/                    # V1版本插件
│   └── emptyfilecleaner/
│       ├── __init__.py        # 插件主文件
│       └── README.md          # 详细说明文档
├── plugins.v2/                # V2版本插件
│   └── emptyfilecleaner/
│       └── __init__.py        # 插件主文件
├── package.json               # V1版本插件配置
├── package.v2.json           # V2版本插件配置
└── README.md                 # 本文件
```

## 快速开始

### 1. 安装插件

将插件文件复制到 MoviePilot 的插件目录中：
- V1版本：`plugins/emptyfilecleaner/`
- V2版本：`plugins.v2/emptyfilecleaner/`

### 2. 基本配置

1. 在 MoviePilot 管理界面中启用"空文件清理器"插件
2. 配置目标目录（每行一个目录路径）
3. 配置排除目录（可选）
4. 设置执行周期（默认每天凌晨2点）

### 3. 安全建议

⚠️ **首次使用请务必开启"测试模式"**，确认要删除的文件无误后再关闭测试模式执行实际删除。

## 配置说明

### 基本设置
- **启用插件**: 是否启用插件
- **立即运行一次**: 启用后立即执行一次清理任务
- **发送通知**: 是否在任务完成后发送通知消息

### 执行设置
- **执行周期**: 使用Cron表达式设置定时执行周期
- **最小文件大小**: 小于等于该大小（字节）的文件将被视为空文件

### 目录设置
- **目标目录**: 需要清理的目录列表，每行一个目录路径
- **排除目录**: 需要排除的目录列表，这些目录本身不会被删除，但会检查其中的空文件

### 高级设置
- **删除空目录**: 是否同时删除空目录
- **测试模式**: 开启后只会记录将要删除的文件，不会实际删除

## 使用示例

### 示例1：清理下载目录
```
目标目录:
/downloads
/media/incomplete

排除目录:
/downloads/working
/downloads/temp

最小文件大小: 0
```

### 示例2：清理媒体库小文件
```
目标目录:
/media/movies
/media/tv

排除目录:
/media/movies/.metadata
/media/tv/.metadata

最小文件大小: 1024
删除空目录: 是
```

## 远程控制

支持通过远程命令手动触发清理：
```
/clean_empty_files
```

## 注意事项

1. **数据安全**: 空文件清理存在数据丢失风险，请：
   - 首次使用开启测试模式
   - 定期备份重要数据
   - 仔细配置排除目录

2. **排除目录**: 
   - 排除目录本身不会被删除
   - 排除目录内的空文件仍会被检查和删除
   - 支持多级目录排除

3. **性能考虑**:
   - 大目录扫描可能需要较长时间
   - 建议在系统空闲时执行

## 版本兼容性

- **V1版本**: 适用于 MoviePilot V1.x
- **V2版本**: 适用于 MoviePilot V2.x，增加了线程安全和更好的错误处理

## 开发信息

- **插件标准**: 遵循 [MoviePilot 插件开发规范](https://github.com/jxxghp/MoviePilot-Plugins)
- **参考库**: 基于 [yubanmeiqin9048/MoviePilot-Plugins](https://github.com/yubanmeiqin9048/MoviePilot-Plugins) 的实现模式
- **许可证**: GPL-3.0

## 更新日志

### v1.0.1
- 优化代码结构
- 增加线程安全锁
- 改进错误处理

### v1.0.0
- 初始版本
- 支持空文件清理
- 支持目录排除功能
- 支持测试模式
